---
title: "常用作图脚本"
---

准备一套作图脚本供日后使用。目标包括：

- 直出 pdf
- 文字数据可选中
- 矢量图，放缩无损
- 风格统一

## 折线图

```vega-lite
{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json",
  "config": {
    "axisX": {
      "tickMinStep": 50
    },
    "axisY": {
      "tickMinStep": 10000
    },
    "view": {
      "continuousHeight": 300,
      "continuousWidth": 400
    }
  },
  "data": {
    "name": "data-90c5cf575d993e0ad54f896cfbb5c8e6"
  },
  "datasets": {
    "data-90c5cf575d993e0ad54f896cfbb5c8e6": [
      {
        "GPU": "K40",
        "L1": 64,
        "L2": 1536
      },
      {
        "GPU": "P100",
        "L1": 64,
        "L2": 4096
      },
      {
        "GPU": "V100",
        "L1": 128,
        "L2": 6144
      },
      {
        "GPU": "A100",
        "L1": 192,
        "L2": 40960
      },
      {
        "GPU": "H100",
        "L1": 256,
        "L2": 51200
      }
    ]
  },
  "height": 300,
  "layer": [
    {
      "encoding": {
        "text": {
          "field": "GPU",
          "type": "nominal"
        },
        "x": {
          "field": "L1",
          "scale": {
            "domain": [
              50,
              250
            ]
          },
          "title": "L1D+SMEM/KB/SM",
          "type": "quantitative"
        },
        "y": {
          "field": "L2",
          "scale": {
            "domain": [
              0,
              50000
            ]
          },
          "title": "L2/KB",
          "type": "quantitative"
        }
      },
      "mark": "line"
    },
    {
      "encoding": {
        "text": {
          "field": "GPU",
          "type": "nominal"
        },
        "x": {
          "field": "L1",
          "scale": {
            "domain": [
              50,
              250
            ]
          },
          "title": "L1D+SMEM/KB/SM",
          "type": "quantitative"
        },
        "y": {
          "field": "L2",
          "scale": {
            "domain": [
              0,
              50000
            ]
          },
          "title": "L2/KB",
          "type": "quantitative"
        }
      },
      "mark": {
        "align": "left",
        "baseline": "middle",
        "dx": 5,
        "dy": 5,
        "type": "text"
      }
    }
  ],
  "width": 400
}
```

```python3
import altair as alt  # tested on altair==4.2.0 && altair==5.2.0
from vl_convert import vegalite_to_pdf  # test on vl-convert-python==1.3.0
import sys


def main(*argv):
    data = [
        {"GPU": "K40", "L1": 64, "L2": 1536},
        {"GPU": "P100", "L1": 64, "L2": 4096},
        {"GPU": "V100", "L1": 128, "L2": 6144},
        {"GPU": "A100", "L1": 192, "L2": 40960},
        {"GPU": "H100", "L1": 256, "L2": 51200},
    ]

    data = alt.Chart(alt.InlineData(data)).encode(
        x=alt.X(
            "L1",
            type="quantitative",
            title="L1D+SMEM/KB/SM",
            scale=alt.Scale(domain=(50, 250)),
        ),
        y=alt.Y(
            "L2",
            type="quantitative",
            title="L2/KB",
            scale=alt.Scale(domain=(0, 50000)),
        ),
        text=alt.Text("GPU", type="nominal"),
    )

    data = data.mark_line() + data.mark_text(
        align="left", baseline="middle", dx=5, dy=5
    )

    data = (
        data.configure_axisY(tickMinStep=10000)
        .configure_axisX(tickMinStep=50)
        .properties(width=400, height=300)
    )

    open("gpu-evole.pdf", "wb").write(vegalite_to_pdf(vl_spec=data.to_json()))
    print(data.to_json())

    return 0


if __name__ == "__main__":
    sys.exit(main(*sys.argv))
```
